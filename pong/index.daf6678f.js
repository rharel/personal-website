function t(t,e,i){return t<e?e:t>i?i:t}class e{clamp(i,n){return new e(t(this.x,i.x,n.x),t(this.y,i.y,n.y))}distance_squared_to(t){return(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)}magnitude(){return Math.sqrt(this.distance_squared_to(new e(0,0)))}normalized(){return new e(this.x/this.magnitude(),this.y/this.magnitude())}plus(t){return new e(this.x+t.x,this.y+t.y)}times(t){return new e(this.x*t,this.y*t)}constructor(t,e){this.x=t,this.y=e}}function i(t){return{ball_position:new e(0,0),ball_velocity:new e(0,t.ball_initial_speed),player_paddle_x:0,ai_paddle_x:0,...t}}function n(t,i){if(a(t))return t;const{ball_radius:n,ball_max_bounce_angle:l,paddle_width:d,paddle_height:r,ai_movement_speed:_}=t;let c={position:t.ball_position.plus(t.ball_velocity.times(i)),velocity:t.ball_velocity};var h,p,u;return c=o(n,l,c.position,c.velocity,t.player_paddle_x,1-.5*t.paddle_height,d,r),c=o(n,l,c.position,c.velocity,t.ai_paddle_x,.5*t.paddle_height-1,d,r),h=n,p=c.position,u=c.velocity,c=p.x-h<-1?{position:new e(-1+h,p.y),velocity:new e(-1*u.x,u.y)}:p.x+h>1?{position:new e(1-h,p.y),velocity:new e(-1*u.x,u.y)}:{position:p,velocity:u},{...t,ball_position:c.position,ball_velocity:c.velocity,ai_paddle_x:t.ai_paddle_x+i*s(n,l,c.position,c.velocity,t.player_paddle_x,t.ai_paddle_x,d,r,_)}}function a(t){return null!==l(t)}function l(t){return t.ball_position.y-t.ball_radius<-1?"player":t.ball_position.y+t.ball_radius>1?"ai":null}function o(t,i,n,a,l,o,s,d){const r=l-.5*s,_=l+.5*s,c=o-.5*d,h=o+.5*d,p=n.clamp(new e(r,c),new e(_,h));if(!(n.distance_squared_to(p)<t*t))return{position:n,velocity:a};const u=a.y<0?h+t+.001:c-t-.001,y=a.normalized();y.y*=-1;const x=Math.abs((n.y-u)/y.y),m=n.plus(y.times(x)),v=(m.x-l)/(.5*s),b=.5*Math.PI-v*i;return{position:m,velocity:new e(Math.cos(b),-Math.sign(a.y)*Math.sin(b)).times(a.magnitude())}}function s(e,i,n,a,l,o,s,d,r){if(a.y>=0)return 0;const _=Math.sign(a.y),c=Math.sign(a.x),h=-c,p=(Math.abs(_-n.y)-d-e)/Math.abs(a.y),u=Math.abs(a.x*p),y=Math.abs(c-n.x)-e;let x;if(u<y)x=n.x+a.x*p;else{const t=2-2*e,i=(u-y)%t;x=Math.floor((u-y)/t)%2==0?c-Math.sign(a.x)*i:h+Math.sign(a.x)*i}const m=-Math.sign(l)*(1-e);return r*(x-.5*t(Math.atan((m-x)/2)/i,-1,1)*s-o)}window.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("demo-canvas");if(!(t instanceof HTMLCanvasElement))throw new Error("cannot find canvas");const e=t.getContext("2d",{alpha:!1});if(null===e)throw new Error("cannot get context");const o={ball_radius:.05,ball_initial_speed:1.6,ball_max_bounce_angle:.3*Math.PI,paddle_width:.4,paddle_height:.05,ai_movement_speed:1},s={background_color:"white",foreground_color:"#ed12a5"};let d=i(o),r=null;t.addEventListener("mousemove",(e=>{e.preventDefault(),d.player_paddle_x=e.offsetX/t.clientWidth*2-1})),t.addEventListener("touchmove",(e=>{const i=e.touches.item(0);if(null===i)return;e.preventDefault();const n=t.getBoundingClientRect();d.player_paddle_x=(i.clientX-n.left)/t.clientWidth*2-1}));const _=()=>{const t=performance.now(),c=r?(t-r)/1e3:0;r=t,d=n(d,c),function(t,e,i){e.fillStyle=i.background_color,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.save(),e.scale(e.canvas.width/2,e.canvas.height/2),e.translate(1,1),e.fillStyle=i.foreground_color,e.beginPath(),e.rect(t.player_paddle_x-.5*t.paddle_width,1-t.paddle_height,t.paddle_width,t.paddle_height),e.rect(t.ai_paddle_x-.5*t.paddle_width,-1,t.paddle_width,t.paddle_height),e.arc(t.ball_position.x,t.ball_position.y,t.ball_radius,0,2*Math.PI),e.fill(),e.restore()}(d,e,s),a(d)?("player"===l(d)&&o.ball_initial_speed<3&&(o.ball_initial_speed+=.2,o.ai_movement_speed+=.2),d=i(o),r=null,setTimeout((()=>requestAnimationFrame(_)),1e3)):requestAnimationFrame(_)};_()}));
//# sourceMappingURL=index.daf6678f.js.map
