!function(){function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function i(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function n(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function o(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function s(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,i){if(t){if("string"==typeof t)return o(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,i):void 0}}(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,i,e,n,o){var s=null,r=null;function a(){var l=performance.now(),c=null!==r?(l-r)/1e3:1/60;r=l,t.step(c),function(t,i,e,n){for(var o in i.save(),i.fillStyle=e,i.fillRect(0,0,i.canvas.width,i.canvas.height),i.translate(0,i.canvas.height),i.scale(1,-1),i.scale(i.canvas.width/t.options.size,i.canvas.height/t.options.size),n){var s=n[o].fill,r=t.entity(parseInt(o));i.beginPath(),i.arc(r.position.x,r.position.y,r.radius,0,2*Math.PI),i.fillStyle=s,i.fill()}i.restore()}(t,i,e,n),o&&o(),null!==s&&(s=requestAnimationFrame(a))}return s=requestAnimationFrame(a),{pause:function(){null!==s&&(cancelAnimationFrame(s),s=null,r=null)},resume:function(){null===s&&(r=performance.now(),s=requestAnimationFrame(a))}}}var a=function(){"use strict";function i(e,n){t(this,i),this.x=e,this.y=n}return e(i,[{key:"clone",value:function(){return new i(this.x,this.y)}},{key:"assign",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"normalize",value:function(){var t=1/this.length();return this.x*=t,this.y*=t,this}},{key:"set_length",value:function(t){var i=t/this.length();return this.x*=i,this.y*=i,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"subtract",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"length_squared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"distance_squared_to",value:function(t){var i=t.x-this.x,e=t.y-this.y;return i*i+e*e}}]),i}();var l=function(){"use strict";function i(e,n,o,s){t(this,i),this.top=e,this.left=n,this.width=o,this.height=s,this.bottom=this.top-this.height,this.right=this.left+this.width}return e(i,[{key:"overlaps",value:function(t){return t.left<=this.right&&t.right>=this.left&&t.bottom<=this.top&&t.top>=this.bottom}}],[{key:"from_center_and_radius",value:function(t,e,n){return new i(e+n,t-n,n,n)}}]),i}(),c=function(){"use strict";function i(e,n){if(t(this,i),this.depth=e,this.bounds=n,this.node={kind:"leaf",items:[]},this.depth<1)throw new Error("quadtree node cannot have depth < 1");if(1===this.depth)this.node={kind:"leaf",items:[]};else if(this.depth>1){var o=e-1,s=this.bounds.top,r=this.bounds.left,a=.5*this.bounds.width,c=.5*this.bounds.height;this.node={kind:"internal",sw:new i(o,new l(s-c,r,a,c)),se:new i(o,new l(s-c,r+a,a,c)),nw:new i(o,new l(s,r,a,c)),ne:new i(o,new l(s,r+a,a,c))}}}return e(i,[{key:"nr_items",value:function(){if("leaf"===this.node.kind)return this.node.items.length;var t=0;return this.for_each_child((function(i){return t+=i.nr_items()})),t}},{key:"clear",value:function(){"leaf"===this.node.kind?this.node.items.length=0:this.for_each_child((function(t){return t.clear()}))}},{key:"add",value:function(t,i){i.overlaps(this.bounds)&&("internal"===this.node.kind?this.for_each_child((function(e){e.bounds.overlaps(i)&&e.add(t,i)})):this.node.items.includes(t)||this.node.items.push(t))}},{key:"remove",value:function(t,i){if(i.overlaps(this.bounds))if("internal"===this.node.kind)this.for_each_child((function(e){e.bounds.overlaps(i)&&e.remove(t,i)}));else if(this.node.items.includes(t)){var e=this.node.items.indexOf(t);this.node.items.splice(e,1)}}},{key:"for_each_child",value:function(t){"leaf"!==this.node.kind&&(t(this.node.sw),t(this.node.se),t(this.node.nw),t(this.node.ne))}},{key:"for_each_leaf_with_at_least",value:function(t,i){this.nr_items()<t||("leaf"===this.node.kind?i(this.node.items):this.for_each_child((function(e){return e.for_each_leaf_with_at_least(t,i)})))}}]),i}(),u=function(){"use strict";function i(e){t(this,i),this.options=e,this.quadtree=new c(e.subdivisions,new l(e.bounds_size,0,e.bounds_size,e.bounds_size))}return e(i,[{key:"clear",value:function(){this.quadtree.clear()}},{key:"add",value:function(t){this.quadtree.add(t,l.from_center_and_radius(t.position.x,t.position.y,t.radius))}},{key:"remove",value:function(t){this.quadtree.remove(t,l.from_center_and_radius(t.position.x,t.position.y,t.radius))}},{key:"moved",value:function(t,i){var e=l.from_center_and_radius(i.x,i.y,t.radius),n=l.from_center_and_radius(t.position.x,t.position.y,t.radius);this.quadtree.remove(t,e),this.quadtree.add(t,n)}},{key:"for_each_potential_collision_group",value:function(t){this.quadtree.for_each_leaf_with_at_least(2,(function(i){t(i)}))}}]),i}();function h(t,i,e,n,o,r){var a,l,c,u=i.x-o.x,h=i.y-o.y,d=u*u,f=h*h,y=t.x-n.x,v=t.y-n.y,p=(c=(l=2*(y*u+v*h))*l-4*(a=d+f)*(y*y+v*v-(e+r)*(e+r)))<0?{count:0}:c>0?{count:2,x1:(-l+Math.sqrt(c))/(2*a),x2:(-l-Math.sqrt(c))/(2*a)}:{count:1,x1:-l/(2*a)};if(2===p.count){var _=s(p.x1<=p.x2?[p.x1,p.x2]:[p.x2,p.x1],2),m=_[0],w=_[1];return m<0&&w>=0?0:m}return 1===p.count?p.x1:-1}function d(t,i){for(var e=[],n=0;n<t.length;++n)for(var o=t[n],s=n+1;s<t.length;++s){var r=t[s];if(!o.static||!r.static){var a=h(o.position,o.velocity,o.radius,r.position,r.velocity,r.radius);0<=a&&a<=i&&e.push({entities:[o,r],time:a})}}return e}function f(t){for(var i,e,n,o,s=[],r=0;r<t.length;++r)for(var a=t[r],l=r+1;l<t.length;++l){var c=t[l];if((!a.static||!c.static)&&(i=a.position,e=a.radius,n=c.position,o=c.radius,i.distance_squared_to(n)<=(e+o)*(e+o))){s.push([a,c]);break}}return s}function y(t,i){if(!t.static||!i.static){if(i.static){var e=t;t=i,i=e}var n=t.position.clone().subtract(i.position).set_length(t.radius+i.radius),o=t.velocity.clone().subtract(i.velocity),s=2*(.5*(t.elasticity+i.elasticity))*o.dot(n)/((t.mass+i.mass)*n.length_squared());t.static||t.velocity.subtract(n.clone().scale(s*i.mass)),i.static||i.velocity.subtract(n.clone().scale(-s*t.mass))}}function v(t,i,e){if(!t.static||!i.static){var n=t.radius+i.radius+e,o=t.position.distance_squared_to(i.position);if(!(o>=n*n)){var s=t.position.clone().subtract(i.position).normalize(),r=n-Math.sqrt(o);t.static?i.position.add(s.scale(-r)):i.static?t.position.add(s.scale(r)):(t.position.add(s.clone().scale(.5*r)),i.position.add(s.clone().scale(.5*-r)))}}}var p=Math.pow(10,14);function _(t,i){var e=t.applied_force,n=1/t.mass,o=t.position,s=t.velocity,r=.5*i*n;o.x+=i*(s.x+r*e.x),o.y+=i*(s.y+r*e.y);var a=i*n;s.x+=a*e.x,s.y+=a*e.y}var m=function(){"use strict";function i(e){t(this,i),this.options=e,this.next_entity_id=0,this.entities=new Map,this.collision_culler=new u({subdivisions:e.collision_culling_subdivisions,bounds_size:e.size})}return e(i,[{key:"clear",value:function(){this.collision_culler.clear(),this.entities.clear()}},{key:"spawn",value:function(t){var i={mass:t.static?p:void 0!==t.mass?t.mass:1,radius:void 0!==t.radius?t.radius:1,elasticity:void 0!==t.elasticity?t.elasticity:0,static:void 0!==t.static&&t.static,position:void 0!==t.position?new a(t.position.x,t.position.y):new a(0,0),velocity:void 0!==t.velocity?new a(t.velocity.x,t.velocity.y):new a(0,0),applied_force:void 0!==t.applied_force?new a(t.applied_force.x,t.applied_force.y):new a(0,0)},e=this.next_entity_id;return this.next_entity_id+=1,this.entities.set(e,i),this.collision_culler.add(i),e}},{key:"remove",value:function(t){if(!this.entities.has(t))throw new Error("bad entity id");var i=this.entities.get(t);this.collision_culler.remove(i),this.entities.delete(t)}},{key:"entity",value:function(t){if(!this.entities.has(t))throw new Error("bad entity id");var i=this.entities.get(t);return function(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{},o=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(e).filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})))),o.forEach((function(i){n(t,i,e[i])}))}return t}({},i,{position:{x:i.position.x,y:i.position.y},velocity:{x:i.velocity.x,y:i.velocity.y},applied_force:{x:i.applied_force.x,y:i.applied_force.y}})}},{key:"update",value:function(t,i){if(!this.entities.has(t))throw new Error("bad entity id");var e=this.entities.get(t),n=e.position.clone();void 0!==i.mass&&(e.mass=i.mass),void 0!==i.radius&&(e.radius=i.radius),void 0!==i.elasticity&&(e.elasticity=i.elasticity),void 0!==i.static&&(e.static=i.static,e.static&&(e.mass=p)),void 0!==i.position&&(e.position.x=i.position.x,e.position.y=i.position.y),void 0!==i.velocity&&(e.velocity.x=i.velocity.x,e.velocity.y=i.velocity.y),void 0!==i.applied_force&&(e.applied_force.x=i.applied_force.x,e.applied_force.y=i.applied_force.y),void 0===i.position&&void 0===i.radius||this.collision_culler.moved(e,n)}},{key:"for_each_entity",value:function(t){var i=this;this.entities.forEach((function(e,n){t(n,i.entity(n))}))}},{key:"step",value:function(t){if(t<=0)throw new Error("cannot step with dt <= 0");this.separate_colliding_entities(),this.options.high_precision?this.step_with_high_precision(t):this.step_with_low_precision(t),this.entities.forEach((function(t){t.velocity.length_squared()<.001&&(t.velocity.x=0,t.velocity.y=0)}))}},{key:"separate_colliding_entities",value:function(){var t=this,i=new Map;this.collision_culler.for_each_potential_collision_group((function(t){for(var e=f(t);e.length>0;){var n=!0,o=!1,r=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var c=s(a.value,2),u=c[0],h=c[1];u.static||i.set(u,u.position.clone()),h.static||i.set(h,h.position.clone()),v(u,h,.001),y(u,h)}}catch(t){o=!0,r=t}finally{try{n||null==l.return||l.return()}finally{if(o)throw r}}e=f(t)}})),i.forEach((function(i,e){t.collision_culler.moved(e,i)}))}},{key:"step_with_high_precision",value:function(t){var i=this,e=new Set,n=new Map;this.entities.forEach((function(t){n.set(t,t.position.clone())})),this.collision_culler.for_each_potential_collision_group((function(n){for(var o=0;o<n.length;++o)e.add(n[o]);i.step_entity_group(n,t)})),this.entities.forEach((function(i){e.has(i)||_(i,t)})),n.forEach((function(t,e){i.collision_culler.moved(e,t)}))}},{key:"step_entity_group",value:function(t,i){for(var e=i;e>.001;){var n=null,o=!0,s=!1,r=void 0;try{for(var a,l=d(t,e)[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var c=a.value;(null===n||c.time<n.time)&&(n=c)}}catch(t){s=!0,r=t}finally{try{o||null==l.return||l.return()}finally{if(s)throw r}}var u=null!==n?n.time:i,h=!0,f=!1,p=void 0;try{for(var m,w=t[Symbol.iterator]();!(h=(m=w.next()).done);h=!0){_(m.value,u)}}catch(t){f=!0,p=t}finally{try{h||null==w.return||w.return()}finally{if(f)throw p}}null!==n&&(y(n.entities[0],n.entities[1]),v(n.entities[0],n.entities[1],.001)),e-=u}}},{key:"step_with_low_precision",value:function(t){var i=this;this.entities.forEach((function(e){if(!e.static){var n=e.position.clone();_(e,t),i.collision_culler.moved(e,n)}}))}}]),i}(),w=["red","blue","brown","green","orange","magenta","purple"];function x(t,i){return t+Math.random()*(i-t)}window.addEventListener("DOMContentLoaded",(function(){for(var t={},i=new m({size:1,collision_culling_subdivisions:3,high_precision:!0}),e=0;e<50;++e){var n=x(.012,.03),o=Math.PI*n*n;t[i.spawn({mass:o,radius:n,elasticity:.95,position:{x:x(n,i.options.size-n),y:x(n,i.options.size-n)},velocity:new a(x(-1,1),x(-1,1)).set_length(x(.1,.5))})]={fill:w[e%w.length]}}var s=document.getElementsByClassName("demo-canvas");if(1!==s.length)throw new Error("expected 1 demo canvas, found ".concat(s.length));var l,c=s.item(0);if(!(c instanceof HTMLCanvasElement))throw new Error("expected canvas element, found ".concat(void 0===c?"undefined":(l=c)&&l.constructor===Symbol?"symbol":typeof l));var u=c.getContext("2d",{alpha:!1});if(null===u)throw new Error("cannot get rendering context");var h=r(i,u,"white",t,(function(){var t=0;i.for_each_entity((function(e,n){var o=!1;n.position.x<n.radius&&(n.position.x=n.radius,n.velocity.x*=-1,o=!0),n.position.x>i.options.size-n.radius&&(n.position.x=i.options.size-n.radius,n.velocity.x*=-1,o=!0),n.position.y<n.radius&&(n.position.y=n.radius,n.velocity.y*=-1,o=!0),n.position.y>i.options.size-n.radius&&(n.position.y=i.options.size-n.radius,n.velocity.y*=-1,o=!0),o&&i.update(e,{position:n.position,velocity:n.velocity}),t+=n.velocity.x+n.velocity.y})),0===t&&h.pause()}))}))}();
//# sourceMappingURL=index.e0d2af00.js.map
